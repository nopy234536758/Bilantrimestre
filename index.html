<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire Conseil de Classe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-pulse-slow { animation: pulse 2s infinite; }
        .animate-bounce-slow { animation: bounce 2s infinite; }
        
        .slider-hacker::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: #22c55e;
            cursor: pointer;
            border: 2px solid #000;
            border-radius: 0;
        }
        .slider-minimalist::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            background: #111827;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .slider-kawaii::-webkit-slider-thumb {
            appearance: none;
            width: 28px;
            height: 28px;
            background: #ec4899;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(236, 72, 153, 0.4);
        }
        
        .slider-hacker::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #22c55e;
            cursor: pointer;
            border: 2px solid #000;
            border-radius: 0;
        }
        .slider-minimalist::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #111827;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .slider-kawaii::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: #ec4899;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(236, 72, 153, 0.4);
        }
        
        .tutorial-highlight {
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5);
            z-index: 100;
            position: relative;
        }
        
        .help-bubble {
            position: absolute;
            background: white;
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 280px;
            z-index: 101;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .help-bubble::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }
        
        .help-bubble.top::after {
            bottom: -10px;
            left: 20px;
            border-width: 10px 10px 0 10px;
            border-color: white transparent transparent transparent;
        }
        
        .help-bubble.bottom::after {
            top: -10px;
            left: 20px;
            border-width: 0 10px 10px 10px;
            border-color: transparent transparent white transparent;
        }
        
        .help-bubble.left::after {
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 10px 0 10px 10px;
            border-color: transparent transparent transparent white;
        }
        
        .help-bubble.right::after {
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 10px 10px 10px 0;
            border-color: transparent white transparent transparent;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // Configuration et donn√©es
        const CONFIG = {
            FORM_ID: '1FAIpQLSdUutK6wUEX2CuTHkbiYTO2EPSoU2jwWQkUPsfaBPzJ2th21w',
            get FORM_ACTION() { return `https://docs.google.com/forms/d/e/${this.FORM_ID}/formResponse`; }
        };

        const QUESTIONS = [
            { id: 'entry.562363546', type: 'radio', question: 'Veux-tu garder ton anonymat lors du conseil de classe ?', options: ['Oui', 'Non'] },
            { id: 'entry.1154952827', type: 'text', question: 'Qui es-tu ?' },
            
            { type: 'section', title: 'Partie 1 : Ambiance g√©n√©rale de la classe', subtitle: 'Sur une √©chelle de 1 √† 10, comment tu √©values...' },
            { id: 'entry.971293297', type: 'scale', question: 'Que penses-tu de l\'ambiance g√©n√©rale de la classe ?' },
            { id: 'entry.758655926', type: 'scale', question: 'Le respect entre √©l√®ves' },
            { id: 'entry.344579238', type: 'scale', question: 'Le niveau de motivation dans la classe' },
            { id: 'entry.1819721634', type: 'scale', question: 'Le climat de travail dans la classe' },
            { id: 'entry.349003755', type: 'scale', question: '√Ä quel point tu te sens serein dans la classe ?' },
            { id: 'entry.1137800935', type: 'scale', question: 'Le s√©rieux global de la classe' },
            { id: 'entry.1789767323', type: 'scale', question: 'Le sentiment de s√©curit√© dans la classe' },
            { id: 'entry.53674337', type: 'scale', question: 'L\'envie que tu as de venir en cours gr√¢ce √† l\'ambiance' },
            { id: 'entry.1323206493', type: 'longtext', question: '√âcris toutes les remarques qui ne peuvent pas se r√©sumer √† une note sur 10' },
            
            { type: 'section', title: 'Partie 2 : Travail personnel et organisation', subtitle: 'Sur une √©chelle de 1 √† 10, comment tu √©values...' },
            { id: 'entry.71070638', type: 'scale', question: 'Ton organisation' },
            { id: 'entry.672544970', type: 'scale', question: 'Ton autonomie dans le travail' },
            { id: 'entry.910558859', type: 'scale', question: 'Ta capacit√© √† rester concentr√© longtemps' },
            { id: 'entry.1894024659', type: 'scale', question: 'Tes m√©thodes de r√©vision' },
            { id: 'entry.108519480', type: 'scale', question: 'Ton niveau de sant√© li√© au travail scolaire' },
            { id: 'entry.969136413', type: 'scale', question: 'Ta confiance dans ta capacit√© √† r√©ussir' },
            { id: 'entry.1923676063', type: 'scale', question: '√Ä quel point penses-tu que tes notes correspondent √† tes efforts ?' },
            { id: 'entry.297530821', type: 'scale', question: 'Ta gestion du stress', labels: ['Je stresse trop', 'Je suis confiant'] },
            { id: 'entry.439679883', type: 'scale', question: 'Ta capacit√© √† te d√©tacher de tes devoirs', labels: ['C impossible frrr', 'Je l√¢che quand je veux'] },
            { id: 'entry.861083556', type: 'scale', question: 'Ton niveau de motivation g√©n√©rale pour les cours' },
            { id: 'entry.350870857', type: 'scale', question: '√Ä quel point tu as des obligations en dehors de l\'√©cole ?', labels: ['Rien', 'Je vais exploser'] },
            { id: 'entry.1127130651', type: 'longtext', question: 'Remarques ?' },
            
            { type: 'section', title: 'Partie 3 : En classe', subtitle: 'Sur une √©chelle de 1 √† 10, comment tu √©values...' },
            { id: 'entry.1837266851', type: 'scale', question: 'Ta participation en cours', labels: ['Moi pas parler', 'Moi parler beaucoup'] },
            { id: 'entry.836699724', type: 'scale', question: 'Le rythme des cours', labels: ['Tortue', 'Flash McQueen prime'] },
            { id: 'entry.43159355', type: 'scale', question: 'La difficult√©', labels: ['EZ', 'Harr sa m√®re'] },
            { id: 'entry.1132593514', type: 'scale', question: 'Sur 10 mati√®res (environ), combien te plaisent vraiment ?' },
            { id: 'entry.981283906', type: 'scale', question: 'La clart√© des explications des enseignants' },
            { id: 'entry.540263909', type: 'scale', question: 'Ta compr√©hension des cours', labels: ['Je capte que dalle', 'C bcp trop ez'] },
            { id: 'entry.420482620', type: 'scale', question: 'Le niveau de spam Pronote des profs', labels: ['Y a que dalle sur Pronote', 'C des spambot'] },
            { id: 'entry.967301965', type: 'longtext', question: '√âcris toutes les remarques qui ne peuvent pas se r√©sumer √† une note sur 10' },
            
            { type: 'section', title: 'Plus' },
            { id: 'entry.138021690', type: 'longtext', question: 'Veux-tu faire passer un message au conseil de classe ?' },
            { id: 'entry.311128995', type: 'scale', question: '√Ä quel point trouves-tu ce questionnaire utile ?' },
            { id: 'entry.930153716', type: 'longtext', question: 'Remarques sur l\'utilit√© ?' }
        ];

        const THEMES = {
            minimalist: {
                bg: 'bg-gray-50', text: 'text-gray-900', border: 'border-gray-300',
                borderHover: 'hover:border-gray-900', accentBg: 'bg-gray-900',
                accentText: 'text-gray-700', secondaryBg: 'bg-gray-100',
                progressBg: 'bg-gray-200', font: 'font-sans',
                button: 'bg-gray-800 text-white hover:bg-gray-900',
                helpBg: 'bg-blue-50', helpText: 'text-blue-800', helpBorder: 'border-blue-200'
            },
            kawaii: {
                bg: 'bg-pink-50', text: 'text-pink-600', border: 'border-pink-300',
                borderHover: 'hover:border-pink-500', accentBg: 'bg-pink-500',
                accentText: 'text-pink-500', secondaryBg: 'bg-pink-100',
                progressBg: 'bg-pink-200', font: 'font-sans',
                button: 'bg-pink-500 text-white hover:bg-pink-600',
                helpBg: 'bg-purple-50', helpText: 'text-purple-800', helpBorder: 'border-purple-200'
            },
            hacker: {
                bg: 'bg-black', text: 'text-green-500', border: 'border-green-500/30',
                borderHover: 'hover:border-green-500', accentBg: 'bg-green-500',
                accentText: 'text-green-400', secondaryBg: 'bg-green-500/10',
                progressBg: 'bg-green-950', font: 'font-mono',
                button: 'bg-green-500 text-black hover:bg-green-400',
                helpBg: 'bg-green-900', helpText: 'text-green-300', helpBorder: 'border-green-700'
            }
        };

        const TUTORIAL_STEPS = [
            {
                title: "Bienvenue dans le questionnaire ! üëã",
                content: "Ce guide va t'accompagner pas √† pas pour remplir le questionnaire du conseil de classe. Tu peux passer le tutoriel si tu pr√©f√®res explorer par toi-m√™me.",
                target: null,
                position: "center"
            },
            {
                title: "Barre de progression üìä",
                content: "Ici, tu peux voir o√π tu en es dans le questionnaire. La barre se remplit au fur et √† mesure que tu avances.",
                target: "progress-container",
                position: "bottom"
            },
            {
                title: "Changer le th√®me üé®",
                content: "Tu peux personnaliser l'apparence du questionnaire en cliquant sur cette ic√¥ne. Essaye les diff√©rents th√®mes !",
                target: "theme-btn",
                position: "left"
            },
            {
                title: "R√©pondre aux questions",
                content: "Pour chaque question, choisis ta r√©ponse. Tu peux s√©lectionner une option, √©crire du texte, ou utiliser un curseur selon le type de question.",
                target: "question-input",
                position: "top"
            },
            {
                title: "Passer une question ‚è≠Ô∏è",
                content: "Si tu ne souhaites pas r√©pondre √† une question, tu peux la passer en cliquant ici. Tu pourras toujours y revenir plus tard.",
                target: "skip-btn",
                position: "top"
            },
            {
                title: "Navigation üß≠",
                content: "Utilise ces boutons pour avancer ou revenir en arri√®re. Le bouton suivant ne s'active que lorsque tu as r√©pondu √† la question.",
                target: "navigation-buttons",
                position: "top"
            },
            {
                title: "Besoin d'aide ? üí°",
                content: "√Ä tout moment, tu peux cliquer sur le bouton d'aide en bas √† droite pour revoir ces explications.",
                target: "help-btn",
                position: "left"
            },
            {
                title: "C'est parti ! üöÄ",
                content: "Tu es maintenant pr√™t(e) √† remplir le questionnaire. Prends ton temps et sois honn√™te dans tes r√©ponses !",
                target: null,
                position: "center"
            }
        ];

        class QuestionnaireApp {
            constructor() {
                this.state = {
                    step: 0,
                    submitted: false,
                    theme: 'minimalist',
                    showThemeMenu: false,
                    formData: {},
                    skippedQuestions: new Set(),
                    tutorialActive: true,
                    tutorialStep: 0,
                    helpVisible: false
                };
                this.initFormData();
            }

            initFormData() {
                QUESTIONS.forEach(q => q.id && (this.state.formData[q.id] = ''));
            }

            render() {
                const app = document.getElementById('app');
                if (this.state.submitted) {
                    app.innerHTML = this.renderSuccess();
                    return;
                }
                
                if (this.state.tutorialActive) {
                    app.innerHTML = this.renderTutorial();
                } else {
                    app.innerHTML = this.renderForm();
                }
                
                this.attachEventListeners();
                
                // Mettre √† jour les √©l√©ments highlight√©s pour le tutoriel
                if (this.state.helpVisible) {
                    this.updateTutorialHighlights();
                }
            }

            renderTutorial() {
                const tutorialStep = TUTORIAL_STEPS[this.state.tutorialStep];
                const isFirst = this.state.tutorialStep === 0;
                const isLast = this.state.tutorialStep === TUTORIAL_STEPS.length - 1;
                
                return `
                    <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6">
                        <div class="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full mx-auto animate-fadeIn">
                            <div class="text-center mb-8">
                                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-graduation-cap text-blue-500 text-3xl"></i>
                                </div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Tutoriel</h1>
                                <div class="flex justify-center space-x-2 mb-6">
                                    ${TUTORIAL_STEPS.map((_, i) => `
                                        <div class="w-3 h-3 rounded-full ${i === this.state.tutorialStep ? 'bg-blue-500' : 'bg-gray-300'}"></div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="text-center mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4">${tutorialStep.title}</h2>
                                <p class="text-lg text-gray-600 leading-relaxed">${tutorialStep.content}</p>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-10">
                                ${!isFirst ? `
                                    <button id="tutorial-prev" class="px-6 py-3 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-all font-medium">
                                        <i class="fas fa-arrow-left mr-2"></i>Pr√©c√©dent
                                    </button>
                                ` : ''}
                                
                                <button id="tutorial-next" class="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-all font-medium flex items-center justify-center">
                                    ${isLast ? 'Commencer le questionnaire' : 'Suivant'} 
                                    <i class="fas ${isLast ? 'fa-rocket' : 'fa-arrow-right'} ml-2"></i>
                                </button>
                                
                                ${!isLast ? `
                                    <button id="tutorial-skip" class="px-6 py-3 text-gray-500 hover:text-gray-700 transition-all font-medium">
                                        Passer le tutoriel
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            renderForm() {
                const t = THEMES[this.state.theme];
                const question = QUESTIONS[this.state.step];
                const { progress, currentIndex, totalQuestions } = this.calculateProgress();
                const showSkipOption = this.state.step >= 2 && question.type !== 'section';

                return `
                    <div class="min-h-screen ${t.bg} ${t.text} flex items-center justify-center p-4 sm:p-6 relative transition-colors duration-300">
                        ${this.renderHelpButton(t)}
                        ${this.renderThemeButton(t)}
                        ${this.state.showThemeMenu ? this.renderThemeMenu(t) : ''}

                        <div class="w-full max-w-3xl">
                            ${this.renderProgressHeader(t, currentIndex, totalQuestions)}
                            ${this.renderProgressBar(t, progress, currentIndex, totalQuestions)}
                            
                            <div class="border ${t.border} ${this.getContentBg(t)} ${this.getBorderRadius(t)} transition-all duration-300">
                                ${this.state.theme === 'hacker' && question.type !== 'section' ? this.renderHackerHeader(currentIndex) : ''}
                                
                                <div class="p-4 sm:p-8">
                                    <div class="animate-fadeIn">
                                        ${question.type === 'section' ? this.renderSection(question, t) : `
                                            <div class="${t.font} mb-6">
                                                ${this.state.theme === 'hacker' ? '<span class="text-green-500/60 text-sm">> </span>' : ''}
                                                <span class="${this.getQuestionTextClass(t)}">${question.question}</span>
                                            </div>
                                            <div id="question-input">
                                                ${this.renderQuestionInput(question, t)}
                                            </div>
                                            ${showSkipOption ? this.renderSkipButton(t) : ''}
                                        `}
                                    </div>
                                </div>

                                <div id="navigation-buttons">
                                    ${this.renderNavigation(t, this.isStepComplete())}
                                </div>
                            </div>

                            ${this.renderFooter(t)}
                        </div>
                        
                        ${this.state.helpVisible ? this.renderHelpOverlay(t) : ''}
                    </div>
                `;
            }

            renderHelpButton(t) {
                return `
                    <button id="help-btn" class="fixed bottom-6 right-6 z-40 w-14 h-14 rounded-full ${t.button} shadow-lg flex items-center justify-center transition-all hover:scale-110">
                        <i class="fas fa-question text-lg"></i>
                    </button>
                `;
            }

            renderHelpOverlay(t) {
                const currentStep = this.state.tutorialStep;
                const tutorialStep = TUTORIAL_STEPS[currentStep];
                
                return `
                    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-auto animate-fadeIn">
                            <div class="p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="text-xl font-bold text-gray-800">Aide</h3>
                                    <button id="close-help" class="text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-times text-xl"></i>
                                    </button>
                                </div>
                                
                                <div class="mb-6">
                                    <h4 class="font-semibold text-lg text-gray-800 mb-2">${tutorialStep.title}</h4>
                                    <p class="text-gray-600">${tutorialStep.content}</p>
                                </div>
                                
                                <div class="flex justify-between items-center">
                                    <div class="flex space-x-2">
                                        ${TUTORIAL_STEPS.map((_, i) => `
                                            <div class="w-2 h-2 rounded-full ${i === currentStep ? 'bg-blue-500' : 'bg-gray-300'}"></div>
                                        `).join('')}
                                    </div>
                                    
                                    <div class="flex space-x-2">
                                        <button id="help-prev" class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg ${currentStep === 0 ? 'opacity-50 cursor-not-allowed' : ''}">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button id="help-next" class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg">
                                            ${currentStep === TUTORIAL_STEPS.length - 1 ? 'Terminer' : '<i class="fas fa-chevron-right"></i>'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            updateTutorialHighlights() {
                // Enl√®ve tous les highlights existants
                document.querySelectorAll('.tutorial-highlight').forEach(el => {
                    el.classList.remove('tutorial-highlight');
                });
                
                // Ajoute le highlight pour l'√©l√©ment cible actuel
                const currentStep = TUTORIAL_STEPS[this.state.tutorialStep];
                if (currentStep.target) {
                    const targetElement = document.getElementById(currentStep.target);
                    if (targetElement) {
                        targetElement.classList.add('tutorial-highlight');
                    }
                }
            }

            renderThemeButton(t) {
                return `
                    <button id="theme-btn" class="fixed top-4 right-4 z-40 p-3 border ${t.border} ${t.secondaryBg} ${t.borderHover} transition-all rounded-xl shadow-sm">
                        <i class="fas fa-palette"></i>
                    </button>
                `;
            }

            renderThemeMenu(t) {
                return `
                    <div class="fixed top-20 right-4 z-50 border ${t.border} ${t.bg} p-4 space-y-2 shadow-xl rounded-xl backdrop-blur-sm bg-opacity-95">
                        <div class="text-sm font-medium ${t.text} mb-2">Choisis un th√®me :</div>
                        ${Object.entries(THEMES).map(([key, theme]) => `
                            <button class="theme-option w-full px-4 py-3 text-left border transition-all rounded-lg flex items-center ${this.state.theme === key ? 
                                `${theme.border.replace('/30', '')} ${theme.secondaryBg} ${theme.accentText} font-medium` : 
                                `${t.border} hover:${t.borderHover}`
                            }" data-theme="${key}">
                                <div class="w-4 h-4 rounded-full mr-3 ${key === 'minimalist' ? 'bg-gray-800' : key === 'kawaii' ? 'bg-pink-500' : 'bg-green-500'}"></div>
                                ${key === 'kawaii' ? 'Kawaii ‚ô°' : key.charAt(0).toUpperCase() + key.slice(1)}
                            </button>
                        `).join('')}
                    </div>
                `;
            }

            renderProgressHeader(t, currentIndex, totalQuestions) {
                return `
                    <div id="progress-container" class="mb-4 sm:mb-6 flex items-center gap-2 sm:gap-3 ${t.font} text-xs sm:text-sm">
                        <div class="flex items-center gap-2">
                            <i class="fas ${this.state.theme === 'hacker' ? 'fa-terminal' : 'fa-clipboard-list'} ${t.accentText}"></i>
                            <span class="opacity-60 truncate">${this.state.theme === 'hacker' ? 'conseil_de_classe.sh' : 'Questionnaire Conseil de Classe'}</span>
                        </div>
                        <span class="opacity-40 ml-auto whitespace-nowrap">Question ${currentIndex}/${totalQuestions}</span>
                    </div>
                `;
            }

            renderProgressBar(t, progress, currentIndex, totalQuestions) {
                return `
                    <div class="mb-6 sm:mb-8">
                        <div class="h-2 ${t.progressBg} overflow-hidden rounded-full">
                            <div class="h-full ${t.accentBg} transition-all duration-700 ease-out rounded-full" style="width: ${progress}%"></div>
                        </div>
                        <div class="flex justify-between mt-2 ${t.font} text-xs opacity-60">
                            <span>${this.state.theme === 'hacker' ? `[${Math.round(progress)}%]` : `Progression : ${Math.round(progress)}%`}</span>
                            <span class="whitespace-nowrap">${currentIndex}/${totalQuestions} questions</span>
                        </div>
                    </div>
                `;
            }

            renderHackerHeader(currentIndex) {
                return `
                    <div class="border-b border-green-500/30 px-6 py-3 font-mono text-xs flex items-center gap-2">
                        <span class="opacity-60">$</span>
                        <span>question_${currentIndex}.sh</span>
                    </div>
                `;
            }

            renderSection(section, t) {
                return `
                    <div class="text-center space-y-4 py-4">
                        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full ${t.secondaryBg} mb-2">
                            <i class="fas fa-star ${t.accentText} text-2xl"></i>
                        </div>
                        <h2 class="text-2xl sm:text-3xl font-bold ${t.accentText}">${section.title}</h2>
                        ${section.subtitle ? `
                            <p class="text-sm sm:text-base opacity-60 max-w-2xl mx-auto">
                                ${section.subtitle}
                            </p>
                        ` : ''}
                    </div>
                `;
            }

            renderQuestionInput(question, t) {
                if (this.state.skippedQuestions.has(this.state.step)) {
                    return `
                        <div class="border ${t.border} ${t.secondaryBg} p-6 text-center rounded-xl">
                            <i class="fas fa-forward ${t.accentText} text-2xl mb-3"></i>
                            <p class="${t.accentText} font-medium">Question marqu√©e comme "non r√©pondue"</p>
                            <p class="text-sm opacity-60 mt-1">Tu peux y r√©pondre en cliquant sur "R√©activer cette question"</p>
                        </div>
                    `;
                }

                const value = this.state.formData[question.id];
                const methods = {
                    radio: () => this.renderRadioButtons(question, value, t),
                    text: () => this.renderTextInput(question, value, t),
                    scale: () => this.renderScaleInput(question, value, t),
                    longtext: () => this.renderLongTextInput(question, value, t)
                };
                return methods[question.type]?.() || '';
            }

            renderRadioButtons(question, value, t) {
                return `
                    <div class="space-y-3 ${t.font}">
                        ${question.options.map((option, idx) => `
                            <button type="button" class="radio-btn w-full px-4 py-4 text-left transition-all border rounded-xl flex items-center ${
                                value === option
                                    ? `${t.border.replace('/30', '')} ${t.secondaryBg} ${t.accentText} font-medium`
                                    : `${t.border} ${t.borderHover} opacity-80 hover:opacity-100`
                            }" data-value="${option}">
                                <div class="w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center ${
                                    value === option 
                                        ? `${t.accentBg} border-${t.accentBg.replace('bg-', '')}` 
                                        : t.border
                                }">
                                    ${value === option ? '<i class="fas fa-check text-white text-xs"></i>' : ''}
                                </div>
                                <span>${option}</span>
                            </button>
                        `).join('')}
                    </div>
                `;
            }

            renderTextInput(question, value, t) {
                const bgClass = this.state.theme === 'minimalist' || this.state.theme === 'kawaii' ? 'bg-white' : 'bg-transparent';
                return `
                    <div class="${t.font}">
                        <div class="relative">
                            ${this.state.theme === 'hacker' ? '<span class="absolute left-0 top-3 opacity-60 mr-2">></span>' : ''}
                            <input type="text" class="text-input ${bgClass} border ${t.border} focus:${t.border.replace('/30', '')} outline-none ${t.accentText} w-full p-4 transition-colors rounded-xl" 
                                   value="${value}" placeholder="${this.getPlaceholder('text')}" autofocus>
                        </div>
                        <p class="text-xs opacity-60 mt-2 flex items-center">
                            <i class="fas fa-info-circle mr-1"></i> Appuie sur Entr√©e pour valider
                        </p>
                    </div>
                `;
            }

            renderScaleInput(question, value, t) {
                const hasValue = value !== '';
                const displayValue = hasValue ? value : '5';
                const hasLabels = !!question.labels;

                return `
                    <div class="space-y-6 ${t.font}">
                        ${hasLabels ? `
                            <div class="space-y-4">
                                <div class="flex justify-between text-sm px-1 font-medium">
                                    <span class="text-left max-w-[45%]">${question.labels[0]}</span>
                                    <span class="text-right max-w-[45%]">${question.labels[1]}</span>
                                </div>
                                <input type="range" min="1" max="10" value="${displayValue}" class="scale-slider w-full h-2 ${t.progressBg} appearance-none cursor-pointer slider-${this.state.theme} rounded-full">
                            </div>
                        ` : `
                            <div class="flex items-center gap-4">
                                <span class="opacity-60 text-sm flex-shrink-0">1</span>
                                <input type="range" min="1" max="10" value="${displayValue}" class="scale-slider flex-1 h-2 ${t.progressBg} appearance-none cursor-pointer slider-${this.state.theme} rounded-full">
                                <span class="opacity-60 text-sm flex-shrink-0">10</span>
                            </div>
                        `}
                        
                        <div class="border ${t.border} px-6 py-4 text-center rounded-2xl bg-white bg-opacity-50" data-value-display>
                            ${!hasValue ? `
                                <div class="flex flex-col items-center">
                                    <i class="fas fa-arrows-left-right text-2xl opacity-40 mb-2"></i>
                                    <span class="text-lg ${t.accentText} opacity-60">D√©place le curseur pour r√©pondre</span>
                                </div>
                            ` : `
                                <div class="flex items-center justify-center">
                                    <span class="text-4xl sm:text-5xl ${t.accentText} font-bold mr-2">${displayValue}</span>
                                    <span class="text-xl opacity-60 mt-2">/10</span>
                                </div>
                            `}
                        </div>
                        
                        ${!hasLabels ? `
                            <div class="grid grid-cols-10 gap-1 text-xs opacity-60 text-center">
                                ${Array.from({length: 10}, (_, i) => `<div>${i + 1}</div>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            renderLongTextInput(question, value, t) {
                const bgClass = this.state.theme === 'minimalist' || this.state.theme === 'kawaii' ? 'bg-white' : 'bg-transparent';
                return `
                    <div class="${t.font}">
                        <textarea class="longtext-input w-full ${bgClass} border ${t.border} focus:${t.border.replace('/30', '')} outline-none ${t.accentText} p-4 transition-colors resize-none rounded-xl" 
                                  rows="6" placeholder="${this.getPlaceholder('longtext')}" autofocus>${value}</textarea>
                        <div class="flex justify-between items-center mt-2">
                            <div class="text-xs opacity-60 flex items-center">
                                <i class="fas fa-keyboard mr-1"></i>
                                <span class="char-count">${value.length}</span> caract√®res
                            </div>
                            <div class="text-xs opacity-60">
                                ${value.length > 100 ? '<i class="fas fa-check text-green-500 mr-1"></i> R√©ponse d√©taill√©e' : '√âcris autant que tu veux'}
                            </div>
                        </div>
                    </div>
                `;
            }

            renderSkipButton(t) {
                const isSkipped = this.state.skippedQuestions.has(this.state.step);
                return `
                    <div class="mt-6 pt-4 border-t ${t.border}">
                        <button id="skip-btn" class="skip-btn w-full px-4 py-3 text-left transition-all border ${t.border} ${t.borderHover} rounded-xl flex items-center ${
                            isSkipped ? `${t.border.replace('/30', '')} ${t.secondaryBg} ${t.accentText} opacity-100 font-medium` : 'opacity-70 hover:opacity-100'
                        }">
                            <i class="fas ${isSkipped ? 'fa-undo' : 'fa-forward'} mr-3"></i>
                            <div>
                                <div>${isSkipped ? 'R√©activer cette question' : 'Je ne souhaite pas r√©pondre'}</div>
                                <div class="text-xs opacity-60 mt-1">${isSkipped ? 'Tu pourras √† nouveau r√©pondre √† cette question' : 'Cette question sera marqu√©e comme non r√©pondue'}</div>
                            </div>
                        </button>
                    </div>
                `;
            }

            renderNavigation(t, isComplete) {
                const isLastStep = this.state.step === QUESTIONS.length - 1;
                const isFirstStep = this.state.step === 0;
                
                return `
                    <div class="px-4 sm:px-8 py-4 sm:py-6 flex gap-3 ${t.font} text-sm border-t ${t.border}">
                        ${!isFirstStep ? this.renderButton('prev', 'Pr√©c√©dent', t, false, 'prev-btn', 'fa-arrow-left') : '<div class="flex-1"></div>'}
                        
                        ${!isLastStep ? 
                            this.renderButton('next', 'Suivant', t, isComplete, 'next-btn', 'fa-arrow-right') :
                            this.renderButton('submit', 'Envoyer le questionnaire', t, isComplete, 'submit-btn', 'fa-paper-plane')
                        }
                    </div>
                `;
            }

            renderButton(type, text, t, isEnabled, id, icon) {
                const isHacker = this.state.theme === 'hacker';
                const translations = { prev: 'prev', next: 'next', submit: 'submit' };
                const displayText = isHacker ? translations[type] : text;

                const baseClasses = `flex-1 px-4 sm:px-6 py-3 transition-all flex items-center justify-center gap-3 rounded-xl font-medium`;
                
                if (type === 'prev') {
                    return `
                        <button id="${id}" class="${baseClasses} border ${t.border} ${t.borderHover} ${t.secondaryBg.replace('/10', '/5')} ${t.text}">
                            <i class="fas ${icon}"></i>
                            <span class="hidden sm:inline">${displayText}</span>
                        </button>
                    `;
                }

                const enabledClasses = type === 'submit' ? 
                    `${t.button} shadow-md hover:shadow-lg` :
                    `${t.button} shadow-sm hover:shadow-md`;

                const disabledClasses = `border ${t.border} opacity-40 cursor-not-allowed bg-gray-200 text-gray-500`;

                return `
                    <button id="${id}" class="${baseClasses} ${isEnabled ? enabledClasses : disabledClasses}" ${!isEnabled ? 'disabled' : ''}>
                        <span class="hidden sm:inline">${displayText}</span>
                        <i class="fas ${icon} ${type === 'submit' ? 'sm:ml-2' : ''}"></i>
                    </button>
                `;
            }

            renderFooter(t) {
                const messages = {
                    hacker: '[encrypted connection to google sheets]',
                    minimalist: 'Tes r√©ponses sont anonymes et s√©curis√©es',
                    kawaii: '‚ú® Tes r√©ponses sont envoy√©es avec amour vers Google Sheets ‚ú®'
                };
                return `
                    <div class="mt-6 text-center ${t.font} text-xs opacity-60 flex items-center justify-center">
                        <i class="fas fa-lock mr-2"></i>
                        <span>${messages[this.state.theme]}</span>
                    </div>
                `;
            }

            renderSuccess() {
                const t = THEMES[this.state.theme];
                const messages = {
                    hacker: {
                        icon: 'fa-terminal',
                        header: '$ submit_form --status',
                        main: '> SUCCESS',
                        sub: '> Data transmitted securely'
                    },
                    minimalist: {
                        icon: 'fa-check-circle',
                        header: 'Questionnaire envoy√© !',
                        main: 'Merci d\'avoir partag√© ton avis',
                        sub: 'Tes r√©ponses ont √©t√© enregistr√©es avec succ√®s'
                    },
                    kawaii: {
                        icon: 'fa-heart',
                        header: 'Merci ! ‚ô°',
                        main: 'Ton formulaire a √©t√© envoy√© avec succ√®s !',
                        sub: 'Tes r√©ponses vont aider √† am√©liorer la classe ‚ú®'
                    }
                };

                const msg = messages[this.state.theme];
                return `
                    <div class="min-h-screen ${t.bg} flex items-center justify-center p-6">
                        <div class="border ${t.border} ${this.getContentBg(t)} ${this.getBorderRadius(t)} p-8 sm:p-12 max-w-md w-full text-center animate-fadeIn">
                            <div class="mb-6 flex justify-center">
                                <div class="w-24 h-24 ${t.secondaryBg} rounded-full flex items-center justify-center">
                                    <i class="fas ${msg.icon} ${t.accentText} text-4xl"></i>
                                </div>
                            </div>
                            <div class="${t.font} ${t.text} space-y-4">
                                <h2 class="text-2xl font-bold">${msg.header}</h2>
                                <p class="text-lg opacity-80">${msg.main}</p>
                                <p class="text-sm opacity-60">${msg.sub}</p>
                            </div>
                            <div class="mt-8 pt-6 border-t ${t.border}">
                                <button id="restart-btn" class="px-6 py-3 ${t.button} rounded-xl font-medium">
                                    <i class="fas fa-redo mr-2"></i>Recommencer
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // M√©thodes utilitaires
            calculateProgress() {
                const totalQuestions = QUESTIONS.filter(q => q.type !== 'section').length;
                const currentQuestionIndex = QUESTIONS.slice(0, this.state.step + 1).filter(q => q.type !== 'section').length;
                const progress = (currentQuestionIndex / totalQuestions) * 100;
                return { progress, currentIndex: currentQuestionIndex, totalQuestions };
            }

            getContentBg(t) {
                return this.state.theme === 'minimalist' ? 'bg-white' : 
                       this.state.theme === 'kawaii' ? 'bg-white' : t.bg;
            }

            getBorderRadius(t) {
                return this.state.theme === 'kawaii' ? 'rounded-3xl shadow-xl' : 'rounded-2xl shadow-lg';
            }

            getQuestionTextClass(t) {
                if (this.state.theme === 'kawaii') return 'text-xl sm:text-2xl font-bold';
                if (this.state.theme === 'minimalist') return 'text-lg sm:text-xl font-semibold';
                return `${t.accentText} text-lg sm:text-xl font-semibold`;
            }

            getPlaceholder(type) {
                const placeholders = {
                    hacker: { text: 'type_here...', longtext: '// enter your response here...' },
                    kawaii: { text: '√âcris ici... ‚ô°', longtext: '√âcris tes pens√©es ici... ‚ú®' },
                    default: { text: 'Tape ta r√©ponse ici...', longtext: 'Partage tes remarques ici...' }
                };
                const themePlaceholders = placeholders[this.state.theme] || placeholders.default;
                return themePlaceholders[type];
            }

            isStepComplete() {
                const question = QUESTIONS[this.state.step];
                if (question.type === 'section') return true;
                if (this.state.skippedQuestions.has(this.state.step)) return true;
                
                const value = this.state.formData[question.id];
                if (question.type === 'text' || question.type === 'longtext') {
                    return value.trim() !== '';
                }
                return value !== '';
            }

            // Gestion des √©v√©nements
            attachEventListeners() {
                if (this.state.tutorialActive) {
                    this.attachTutorialEvents();
                } else {
                    this.attachThemeEvents();
                    this.attachNavigationEvents();
                    this.attachQuestionEvents();
                    this.attachHelpEvents();
                }
            }

            attachTutorialEvents() {
                document.getElementById('tutorial-prev')?.addEventListener('click', () => {
                    if (this.state.tutorialStep > 0) {
                        this.state.tutorialStep--;
                        this.render();
                    }
                });

                document.getElementById('tutorial-next')?.addEventListener('click', () => {
                    if (this.state.tutorialStep < TUTORIAL_STEPS.length - 1) {
                        this.state.tutorialStep++;
                        this.render();
                    } else {
                        this.state.tutorialActive = false;
                        this.render();
                    }
                });

                document.getElementById('tutorial-skip')?.addEventListener('click', () => {
                    this.state.tutorialActive = false;
                    this.render();
                });
            }

            attachHelpEvents() {
                document.getElementById('help-btn')?.addEventListener('click', () => {
                    this.state.helpVisible = true;
                    this.state.tutorialStep = 0;
                    this.render();
                });

                document.getElementById('close-help')?.addEventListener('click', () => {
                    this.state.helpVisible = false;
                    this.render();
                });

                document.getElementById('help-prev')?.addEventListener('click', () => {
                    if (this.state.tutorialStep > 0) {
                        this.state.tutorialStep--;
                        this.render();
                    }
                });

                document.getElementById('help-next')?.addEventListener('click', () => {
                    if (this.state.tutorialStep < TUTORIAL_STEPS.length - 1) {
                        this.state.tutorialStep++;
                        this.render();
                    } else {
                        this.state.helpVisible = false;
                        this.render();
                    }
                });
            }

            attachThemeEvents() {
                document.getElementById('theme-btn')?.addEventListener('click', () => {
                    this.state.showThemeMenu = !this.state.showThemeMenu;
                    this.render();
                });

                document.querySelectorAll('.theme-option').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.state.theme = e.target.closest('.theme-option').dataset.theme;
                        this.state.showThemeMenu = false;
                        this.render();
                    });
                });
            }

            attachNavigationEvents() {
                document.getElementById('prev-btn')?.addEventListener('click', () => {
                    if (this.state.step > 0) {
                        this.state.step--;
                        this.render();
                    }
                });

                document.getElementById('next-btn')?.addEventListener('click', () => {
                    if (this.state.step < QUESTIONS.length - 1 && this.isStepComplete()) {
                        this.state.step++;
                        this.render();
                    }
                });

                document.getElementById('submit-btn')?.addEventListener('click', () => {
                    if (this.isStepComplete()) {
                        this.submitToGoogleForms();
                    }
                });

                document.getElementById('restart-btn')?.addEventListener('click', () => {
                    this.state.submitted = false;
                    this.state.step = 0;
                    this.state.formData = {};
                    this.state.skippedQuestions = new Set();
                    this.initFormData();
                    this.render();
                });
            }

            attachQuestionEvents() {
                this.attachSkipEvent();
                this.attachRadioEvents();
                this.attachTextEvents();
                this.attachScaleEvents();
                this.attachLongTextEvents();
            }

            attachSkipEvent() {
                const skipBtn = document.getElementById('skip-btn');
                if (skipBtn) {
                    skipBtn.addEventListener('click', () => {
                        const question = QUESTIONS[this.state.step];
                        if (this.state.skippedQuestions.has(this.state.step)) {
                            this.state.skippedQuestions.delete(this.state.step);
                            this.state.formData[question.id] = '';
                        } else {
                            this.state.skippedQuestions.add(this.state.step);
                            this.state.formData[question.id] = 'Non r√©pondu';
                        }
                        this.render();
                    });
                }
            }

            attachRadioEvents() {
                document.querySelectorAll('.radio-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const question = QUESTIONS[this.state.step];
                        this.state.formData[question.id] = e.currentTarget.dataset.value;
                        this.state.skippedQuestions.delete(this.state.step);
                        this.render();
                    });
                });
            }

            attachTextEvents() {
                const textInput = document.querySelector('.text-input');
                if (textInput) {
                    textInput.addEventListener('input', (e) => this.handleInputChange(e.target.value));
                    textInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && this.isStepComplete()) {
                            document.getElementById('next-btn')?.click();
                        }
                    });
                    textInput.focus();
                }
            }

            attachScaleEvents() {
                const scaleInput = document.querySelector('.scale-slider');
                if (scaleInput) {
                    scaleInput.addEventListener('input', (e) => {
                        const question = QUESTIONS[this.state.step];
                        this.state.formData[question.id] = e.target.value;
                        this.state.skippedQuestions.delete(this.state.step);
                        
                        const valueDisplay = scaleInput.closest('.space-y-6').querySelector('[data-value-display]');
                        if (valueDisplay) {
                            const t = THEMES[this.state.theme];
                            valueDisplay.innerHTML = `
                                <div class="flex items-center justify-center">
                                    <span class="text-4xl sm:text-5xl ${t.accentText} font-bold mr-2">${e.target.value}</span>
                                    <span class="text-xl opacity-60 mt-2">/10</span>
                                </div>
                            `;
                        }
                        this.updateNavigationButtons();
                    });
                }
            }

            attachLongTextEvents() {
                const longtextInput = document.querySelector('.longtext-input');
                if (longtextInput) {
                    longtextInput.addEventListener('input', (e) => {
                        this.handleInputChange(e.target.value);
                        const charCount = document.querySelector('.char-count');
                        if (charCount) {
                            charCount.textContent = e.target.value.length;
                        }
                    });
                    longtextInput.focus();
                }
            }

            handleInputChange(value) {
                const question = QUESTIONS[this.state.step];
                this.state.formData[question.id] = value;
                this.state.skippedQuestions.delete(this.state.step);
                this.updateNavigationButtons();
            }

            updateNavigationButtons() {
                const nextBtn = document.getElementById('next-btn');
                const submitBtn = document.getElementById('submit-btn');
                const isComplete = this.isStepComplete();
                const t = THEMES[this.state.theme];

                [nextBtn, submitBtn].forEach(btn => {
                    if (!btn) return;
                    
                    if (isComplete) {
                        btn.disabled = false;
                        btn.classList.remove('opacity-40', 'cursor-not-allowed', 'bg-gray-200', 'text-gray-500');
                        if (btn.id === 'submit-btn') {
                            btn.classList.add(t.button.replace('hover:', ''));
                        } else {
                            btn.classList.add(t.button.replace('hover:', ''));
                        }
                    } else {
                        btn.disabled = true;
                        btn.classList.add('opacity-40', 'cursor-not-allowed');
                        btn.classList.remove('shadow-md', 'hover:shadow-lg');
                    }
                });
            }

            async submitToGoogleForms() {
                const params = new URLSearchParams();
                Object.entries(this.state.formData).forEach(([key, value]) => {
                    params.append(key, value);
                });

                try {
                    await fetch(CONFIG.FORM_ACTION, {
                        method: 'POST',
                        body: params,
                        mode: 'no-cors'
                    });
                    this.state.submitted = true;
                    this.render();
                } catch (error) {
                    console.log('Envoi r√©ussi (mode no-cors) ou erreur non bloquante:', error);
                    this.state.submitted = true;
                    this.render();
                }
            }
        }

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', () => {
            const app = new QuestionnaireApp();
            app.render();
        });
    </script>
</body>
</html>
